alert: LegoCertificateExpiringCritical
expr: |
  sum by (juju_model, juju_model_uuid, juju_application) (
    count_over_time(
      ({%%juju_topology%%} | json | event="lego_cert_expiring" | severity="critical")[1h]
    )
  ) > 0
for: 10m
labels:
  severity: page
annotations:
  summary: "LEGO certificates are near expiry (critical)"
  description: "One or more certificates reported as critically close to expiry (see lego-operator logs)."
