alert: LegoCertificateExpiringCritical
expr: |
  sum by (juju_model, juju_model_uuid, juju_application, juju_charm) (
    count_over_time(
      ({%%juju_topology%%} |= "\"event\": \"lego_cert_expiring\"" |= "\"severity\": \"critical\"")[1h]
    )
  ) > 0
for: 0m
labels:
  severity: page
annotations:
  summary: "LEGO certificates are near expiry (critical)"
  description: "One or more certificates reported as critically close to expiry (see lego-operator logs)."
